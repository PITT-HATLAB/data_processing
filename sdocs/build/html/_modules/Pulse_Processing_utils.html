
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pulse_Processing_utils &#8212; Hatlab Data Processing 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/classic.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Hatlab Data Processing 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Pulse_Processing_utils</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for Pulse_Processing_utils</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Thu Apr 29 09:40:12 2021</span>

<span class="sd">@author: Ryan Kaufman</span>

<span class="sd">Set up function module that can assist in loading pulse sequences into AWG</span>
<span class="sd">and functionalizing Alazar acquiring</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Ellipse</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">plottr.data.datadict_storage</span> <span class="kn">import</span> <span class="n">all_datadicts_from_hdf5</span>

<div class="viewcode-block" id="Process_One_Acquisition_np"><a class="viewcode-back" href="../Pulse_Processing_Utils.html#Pulse_Processing_utils.Process_One_Acquisition_np">[docs]</a><span class="k">def</span> <span class="nf">Process_One_Acquisition_np</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">pulse_types</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
    
    
    <span class="k">return</span> <span class="n">pulse</span></div>
    

<div class="viewcode-block" id="Process_One_Acquisition"><a class="viewcode-back" href="../Pulse_Processing_Utils.html#Pulse_Processing_utils.Process_One_Acquisition">[docs]</a><span class="k">def</span> <span class="nf">Process_One_Acquisition</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">sI_c1</span><span class="p">,</span> <span class="n">sI_c2</span><span class="p">,</span> <span class="n">sQ_c1</span> <span class="p">,</span><span class="n">sQ_c2</span><span class="p">,</span> <span class="n">bin_start</span><span class="p">,</span> <span class="n">bin_stop</span><span class="p">,</span> <span class="n">hist_scale</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">odd_only</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">even_only</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span> 
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sI_c1</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;even records&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sI_c2</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;odd_records&#39;</span><span class="p">)</span>
        <span class="c1"># ax1.set_aspect(1)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sQ_c1</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;even records&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sQ_c2</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;odd records&#39;</span><span class="p">)</span>
        <span class="c1"># ax2.set_aspect(1)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
        <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sI_c1</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sQ_c1</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sI_c2</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sQ_c2</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">))</span>
        
        <span class="c1">#figure for difference trace</span>
        <span class="n">fig2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
        <span class="n">ax21</span> <span class="o">=</span> <span class="n">fig2</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
        <span class="n">ax21</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;I (even-odd records)&quot;</span><span class="p">)</span>
        <span class="n">ax21</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sI_c1</span><span class="o">-</span><span class="n">sI_c2</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;even-odd records&#39;</span><span class="p">)</span>
        
        <span class="c1"># ax1.set_aspect(1)</span>
        <span class="n">ax22</span> <span class="o">=</span> <span class="n">fig2</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
        <span class="n">ax22</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Q (even-odd records)&quot;</span><span class="p">)</span>
        <span class="n">ax22</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sQ_c1</span><span class="o">-</span><span class="n">sQ_c2</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;even-odd records&#39;</span><span class="p">)</span>
        
        <span class="c1"># ax2.set_aspect(1)</span>
        <span class="n">ax23</span> <span class="o">=</span> <span class="n">fig2</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
        <span class="n">ax23</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Trajectories&quot;</span><span class="p">)</span>
        <span class="n">ax23</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax23</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sI_c1</span><span class="o">-</span><span class="n">sI_c2</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sQ_c1</span><span class="o">-</span><span class="n">sQ_c2</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">))</span>
        
        
        <span class="n">ax24</span> <span class="o">=</span> <span class="n">fig2</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
        <span class="n">ax24</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;magnitudes&quot;</span><span class="p">)</span>
        <span class="n">ax24</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sI_c1</span><span class="o">-</span><span class="n">sI_c2</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sQ_c1</span><span class="o">-</span><span class="n">sQ_c2</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;magnitude&#39;</span><span class="p">)</span>
        <span class="n">ax4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>

    <span class="n">fig2</span><span class="p">,</span> <span class="n">ax99</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="c1"># print(np.shape(sI_c1))</span>
    <span class="n">bins_even</span><span class="p">,</span> <span class="n">h_even</span> <span class="o">=</span> <span class="n">boxcar_histogram</span><span class="p">(</span><span class="n">fig2</span><span class="p">,</span> <span class="n">ax99</span><span class="p">,</span> <span class="n">bin_start</span><span class="p">,</span> <span class="n">bin_stop</span><span class="p">,</span> <span class="n">sI_c1</span><span class="p">,</span> <span class="n">sQ_c1</span><span class="p">,</span> <span class="n">Ioffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Qoffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">hist_scale</span><span class="p">)</span>
    <span class="n">bins_odd</span><span class="p">,</span> <span class="n">h_odd</span> <span class="o">=</span> <span class="n">boxcar_histogram</span><span class="p">(</span><span class="n">fig2</span><span class="p">,</span> <span class="n">ax99</span><span class="p">,</span> <span class="n">bin_start</span><span class="p">,</span> <span class="n">bin_stop</span><span class="p">,</span> <span class="n">sI_c2</span><span class="p">,</span> <span class="n">sQ_c2</span><span class="p">,</span> <span class="n">Ioffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Qoffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">hist_scale</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig2</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span> 
        <span class="k">if</span> <span class="n">even_only</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">odd_only</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;displaying only even&#39;</span><span class="p">)</span>
            <span class="n">boxcar_histogram</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax4</span><span class="p">,</span> <span class="n">bin_start</span><span class="p">,</span> <span class="n">bin_stop</span><span class="p">,</span> <span class="n">sI_c1</span><span class="p">,</span> <span class="n">sQ_c1</span><span class="p">,</span> <span class="n">Ioffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Qoffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">hist_scale</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="n">odd_only</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">even_only</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;displaying only odd&#39;</span><span class="p">)</span>
            <span class="n">boxcar_histogram</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax4</span><span class="p">,</span> <span class="n">bin_start</span><span class="p">,</span> <span class="n">bin_stop</span><span class="p">,</span> <span class="n">sI_c2</span><span class="p">,</span> <span class="n">sQ_c2</span><span class="p">,</span> <span class="n">Ioffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Qoffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">hist_scale</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;displaying both&#39;</span><span class="p">)</span>
            <span class="n">boxcar_histogram</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax4</span><span class="p">,</span> <span class="n">bin_start</span><span class="p">,</span> <span class="n">bin_stop</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">sI_c1</span><span class="p">,</span> <span class="n">sI_c2</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">sQ_c1</span><span class="p">,</span> <span class="n">sQ_c2</span><span class="p">)),</span> <span class="n">Ioffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Qoffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">hist_scale</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">bins_even</span><span class="p">,</span> <span class="n">bins_odd</span><span class="p">,</span> <span class="n">h_even</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">h_odd</span><span class="o">.</span><span class="n">T</span></div>

<div class="viewcode-block" id="Process_One_Acquisition_3_state"><a class="viewcode-back" href="../Pulse_Processing_Utils.html#Pulse_Processing_utils.Process_One_Acquisition_3_state">[docs]</a><span class="k">def</span> <span class="nf">Process_One_Acquisition_3_state</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">sI_c1</span><span class="p">,</span> <span class="n">sI_c2</span><span class="p">,</span> <span class="n">sI_c3</span><span class="p">,</span> <span class="n">sQ_c1</span> <span class="p">,</span><span class="n">sQ_c2</span><span class="p">,</span> <span class="n">sQ_c3</span><span class="p">,</span> <span class="n">bin_start</span><span class="p">,</span> <span class="n">bin_stop</span><span class="p">,</span> <span class="n">hist_scale</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">odd_only</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">even_only</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span> 
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sI_c1</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;G_records&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sI_c2</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;E_records&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sI_c3</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;F_records&#39;</span><span class="p">)</span>
        <span class="c1"># ax1.set_aspect(1)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sQ_c1</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;G records&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sQ_c2</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;E records&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sQ_c3</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;F records&#39;</span><span class="p">)</span>
        <span class="c1"># ax2.set_aspect(1)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
        <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sI_c1</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sQ_c1</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sI_c2</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sQ_c2</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sI_c3</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sQ_c3</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">))</span>
        
        <span class="c1"># #figure for difference trace</span>
        <span class="c1"># fig2 = plt.figure(2, figsize = (12,8))</span>
        <span class="c1"># ax21 = fig2.add_subplot(221)</span>
        <span class="c1"># ax21.set_title(&quot;I (even-odd records)&quot;)</span>
        <span class="c1"># ax21.plot(np.average(sI_c1-sI_c2, axis = 0), label = &#39;even-odd records&#39;)</span>
        
        <span class="c1"># # ax1.set_aspect(1)</span>
        <span class="c1"># ax22 = fig2.add_subplot(222)</span>
        <span class="c1"># ax22.set_title(&quot;Q (even-odd records)&quot;)</span>
        <span class="c1"># ax22.plot(np.average(sQ_c1-sQ_c2, axis = 0), label = &#39;even-odd records&#39;)</span>
        
        <span class="c1"># # ax2.set_aspect(1)</span>
        <span class="c1"># ax23 = fig2.add_subplot(223)</span>
        <span class="c1"># ax23.set_title(&quot;Trajectories&quot;)</span>
        <span class="c1"># ax23.set_aspect(1)</span>
        <span class="c1"># ax23.plot(np.average(sI_c1-sI_c2, axis = 0), np.average(sQ_c1-sQ_c2, axis = 0))</span>
        
        
        <span class="c1"># ax24 = fig2.add_subplot(224)</span>
        <span class="c1"># ax24.set_title(&quot;magnitudes&quot;)</span>
        <span class="c1"># ax24.plot(np.average(sI_c1-sI_c2, axis = 0)**2+np.average(sQ_c1-sQ_c2, axis = 0)**2, label = &#39;magnitude&#39;)</span>
        <span class="n">ax4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>

    <span class="n">fig2</span><span class="p">,</span> <span class="n">ax99</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="c1"># print(np.shape(sI_c1))</span>
    <span class="n">bins_G</span><span class="p">,</span> <span class="n">h_G</span> <span class="o">=</span> <span class="n">boxcar_histogram</span><span class="p">(</span><span class="n">fig2</span><span class="p">,</span> <span class="n">ax99</span><span class="p">,</span> <span class="n">bin_start</span><span class="p">,</span> <span class="n">bin_stop</span><span class="p">,</span> <span class="n">sI_c1</span><span class="p">,</span> <span class="n">sQ_c1</span><span class="p">,</span> <span class="n">Ioffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Qoffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">hist_scale</span><span class="p">)</span>
    <span class="n">bins_E</span><span class="p">,</span> <span class="n">h_E</span> <span class="o">=</span> <span class="n">boxcar_histogram</span><span class="p">(</span><span class="n">fig2</span><span class="p">,</span> <span class="n">ax99</span><span class="p">,</span> <span class="n">bin_start</span><span class="p">,</span> <span class="n">bin_stop</span><span class="p">,</span> <span class="n">sI_c2</span><span class="p">,</span> <span class="n">sQ_c2</span><span class="p">,</span> <span class="n">Ioffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Qoffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">hist_scale</span><span class="p">)</span>
    <span class="n">bins_F</span><span class="p">,</span> <span class="n">h_F</span> <span class="o">=</span> <span class="n">boxcar_histogram</span><span class="p">(</span><span class="n">fig2</span><span class="p">,</span> <span class="n">ax99</span><span class="p">,</span> <span class="n">bin_start</span><span class="p">,</span> <span class="n">bin_stop</span><span class="p">,</span> <span class="n">sI_c3</span><span class="p">,</span> <span class="n">sQ_c3</span><span class="p">,</span> <span class="n">Ioffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Qoffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">hist_scale</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig2</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span> 
        <span class="k">if</span> <span class="n">even_only</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">odd_only</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;displaying only even&#39;</span><span class="p">)</span>
            <span class="n">boxcar_histogram</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax4</span><span class="p">,</span> <span class="n">bin_start</span><span class="p">,</span> <span class="n">bin_stop</span><span class="p">,</span> <span class="n">sI_c1</span><span class="p">,</span> <span class="n">sQ_c1</span><span class="p">,</span> <span class="n">Ioffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Qoffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">hist_scale</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="n">odd_only</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">even_only</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;displaying only odd&#39;</span><span class="p">)</span>
            <span class="n">boxcar_histogram</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax4</span><span class="p">,</span> <span class="n">bin_start</span><span class="p">,</span> <span class="n">bin_stop</span><span class="p">,</span> <span class="n">sI_c2</span><span class="p">,</span> <span class="n">sQ_c2</span><span class="p">,</span> <span class="n">Ioffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Qoffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">hist_scale</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;displaying both&#39;</span><span class="p">)</span>
            <span class="n">boxcar_histogram</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax4</span><span class="p">,</span> <span class="n">bin_start</span><span class="p">,</span> <span class="n">bin_stop</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">sI_c1</span><span class="p">,</span> <span class="n">sI_c2</span><span class="p">,</span> <span class="n">sI_c3</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">sQ_c1</span><span class="p">,</span> <span class="n">sQ_c2</span><span class="p">,</span> <span class="n">sQ_c3</span><span class="p">)),</span> <span class="n">Ioffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Qoffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">hist_scale</span><span class="p">)</span>
        <span class="c1"># plt.show()</span>
    <span class="k">return</span> <span class="n">bins_G</span><span class="p">,</span> <span class="n">bins_E</span><span class="p">,</span> <span class="n">bins_F</span><span class="p">,</span> <span class="n">h_G</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">h_E</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">h_F</span><span class="o">.</span><span class="n">T</span></div>
    
    
<div class="viewcode-block" id="boxcar_histogram"><a class="viewcode-back" href="../Pulse_Processing_Utils.html#Pulse_Processing_utils.boxcar_histogram">[docs]</a><span class="k">def</span> <span class="nf">boxcar_histogram</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">start_pt</span><span class="p">,</span> <span class="n">stop_pt</span><span class="p">,</span> <span class="n">sI</span><span class="p">,</span> <span class="n">sQ</span><span class="p">,</span> <span class="n">Ioffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Qoffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_bins</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
    <span class="n">I_bground</span> <span class="o">=</span> <span class="n">Ioffset</span>
    <span class="n">Q_bground</span> <span class="o">=</span> <span class="n">Qoffset</span>
    <span class="c1"># print(I_bground, Q_bground)</span>
    <span class="n">I_pts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Q_pts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">I_row</span><span class="p">,</span> <span class="n">Q_row</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sI</span><span class="p">,</span> <span class="n">sQ</span><span class="p">):</span> 
        <span class="n">I_pts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">I_row</span><span class="p">[</span><span class="n">start_pt</span><span class="p">:</span><span class="n">stop_pt</span><span class="p">]</span><span class="o">-</span><span class="n">I_bground</span><span class="p">))</span>
        <span class="n">Q_pts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">Q_row</span><span class="p">[</span><span class="n">start_pt</span><span class="p">:</span><span class="n">stop_pt</span><span class="p">]</span><span class="o">-</span><span class="n">Q_bground</span><span class="p">))</span>
    <span class="c1"># plt.imshow(np.histogram2d(np.array(I_pts), np.array(Q_pts))[0])</span>
    <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_bins</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span>
    <span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">xedges</span><span class="p">,</span> <span class="n">yedges</span><span class="p">,</span> <span class="n">im</span><span class="p">)</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span><span class="n">I_pts</span><span class="p">,</span> <span class="n">Q_pts</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="n">bins</span><span class="p">,</span> <span class="n">bins</span><span class="p">])</span>
    <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;5%&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span> <span class="o">=</span> <span class="n">cax</span><span class="p">,</span> <span class="n">orientation</span> <span class="o">=</span> <span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
    <span class="c1"># ax.hexbin(I_pts, Q_pts, extent = np.array([-1,1,-1,1])*scale)</span>
    <span class="c1"># ax.set_xticks(np.array([-100,-75,-50,-25,0,25,50,75,100])*scale/100)</span>
    <span class="c1"># ax.set_yticks(np.array([-100,-75,-50,-25,0,25,50,75,100])*scale/100)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">bins</span><span class="p">,</span> <span class="n">h</span></div>

<div class="viewcode-block" id="Gaussian_2D"><a class="viewcode-back" href="../Pulse_Processing_Utils.html#Pulse_Processing_utils.Gaussian_2D">[docs]</a><span class="k">def</span> <span class="nf">Gaussian_2D</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">amplitude</span><span class="p">,</span> <span class="n">xo</span><span class="p">,</span> <span class="n">yo</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">M</span>
    <span class="n">xo</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">xo</span><span class="p">)</span>
    <span class="n">yo</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">yo</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma_x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">theta</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">sigma_x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">theta</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">sigma_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma_x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">amplitude</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="o">-</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">xo</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">xo</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">yo</span><span class="p">)</span>
                            <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="p">((</span><span class="n">y</span><span class="o">-</span><span class="n">yo</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">g</span></div>


<div class="viewcode-block" id="Gaussian_info"><a class="viewcode-back" href="../Pulse_Processing_Utils.html#Pulse_Processing_utils.Gaussian_info">[docs]</a><span class="k">class</span> <span class="nc">Gaussian_info</span><span class="p">:</span> 
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">info_dict</span> <span class="o">=</span> <span class="p">{}</span>
<div class="viewcode-block" id="Gaussian_info.print_info"><a class="viewcode-back" href="../Pulse_Processing_Utils.html#Pulse_Processing_utils.Gaussian_info.print_info">[docs]</a>    <span class="k">def</span> <span class="nf">print_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> 
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;popt&#39;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;pcov&#39;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span></div>
                
    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_GC</span><span class="p">):</span>
        <span class="n">sub_class</span> <span class="o">=</span> <span class="n">Gaussian_info</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> 
            <span class="c1"># print(key, val)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span> 
                <span class="n">sub_class</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span> <span class="o">-</span> <span class="n">other_GC</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">sub_class</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">sub_class</span>
    
<div class="viewcode-block" id="Gaussian_info.center_vec"><a class="viewcode-back" href="../Pulse_Processing_Utils.html#Pulse_Processing_utils.Gaussian_info.center_vec">[docs]</a>    <span class="k">def</span> <span class="nf">center_vec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;x0&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;y0&#39;</span><span class="p">]])</span></div>
<div class="viewcode-block" id="Gaussian_info.plot_on_ax"><a class="viewcode-back" href="../Pulse_Processing_Utils.html#Pulse_Processing_utils.Gaussian_info.plot_on_ax">[docs]</a>    <span class="k">def</span> <span class="nf">plot_on_ax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">displacement</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span><span class="p">):</span> 
        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">center_vec</span><span class="p">(),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span> <span class="o">=</span> <span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">))</span></div>
<div class="viewcode-block" id="Gaussian_info.plot_array"><a class="viewcode-back" href="../Pulse_Processing_Utils.html#Pulse_Processing_utils.Gaussian_info.plot_array">[docs]</a>    <span class="k">def</span> <span class="nf">plot_array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Gaussian_2D</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;popt&#39;</span><span class="p">])</span></div>
<div class="viewcode-block" id="Gaussian_info.sigma_contour"><a class="viewcode-back" href="../Pulse_Processing_Utils.html#Pulse_Processing_utils.Gaussian_info.sigma_contour">[docs]</a>    <span class="k">def</span> <span class="nf">sigma_contour</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_vec</span><span class="p">()</span>
        <span class="n">sx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;sigma_x&#39;</span><span class="p">]</span>
        <span class="n">sy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;sigma_y&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">Ellipse</span><span class="p">((</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">angle</span> <span class="o">=</span> <span class="n">angle</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="mi">360</span><span class="p">,</span> 
                       <span class="n">fill</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                       <span class="n">ls</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span>
                       <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span>
                       <span class="n">lw</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span></div></div>
        

<div class="viewcode-block" id="fit_2D_Gaussian"><a class="viewcode-back" href="../Pulse_Processing_Utils.html#Pulse_Processing_utils.fit_2D_Gaussian">[docs]</a><span class="k">def</span> <span class="nf">fit_2D_Gaussian</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> 
                    <span class="n">bins</span><span class="p">,</span> 
                    <span class="n">h_arr</span><span class="p">,</span> 
                    <span class="n">guessParams</span><span class="p">,</span> 
                    <span class="n">max_fev</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> 
                    <span class="n">contour_line</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span> 
    
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">resh_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">ravel</span><span class="p">())),</span> <span class="n">h_arr</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="c1"># print(&#39;xdata_shape: &#39;, np.shape(xdata))</span>
    <span class="c1"># print(&quot;y shape: &quot;,np.shape(ydata))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;running curve_fit&quot;</span><span class="p">)</span>
    <span class="c1">#,amplitude, xo, yo, sigma_x, sigma_y, theta</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">bins</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">bins</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
              <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">h_arr</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bins</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bins</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bins</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bins</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">]]</span>
    <span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">Gaussian_2D</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">p0</span> <span class="o">=</span> <span class="n">guessParams</span><span class="p">,</span> <span class="n">maxfev</span> <span class="o">=</span> <span class="n">max_fev</span><span class="p">)</span>
    <span class="n">GC</span> <span class="o">=</span> <span class="n">Gaussian_info</span><span class="p">()</span>
    <span class="n">GC</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">GC</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;canvas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xdata</span> 
    <span class="n">GC</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;amplitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">GC</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;x0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">GC</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;y0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">GC</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;sigma_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">popt</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">GC</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;sigma_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">popt</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">GC</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">GC</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;popt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">popt</span>
    <span class="n">GC</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;pcov&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pcov</span>
    <span class="n">GC</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;contour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_contour_line</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Gaussian_2D</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="o">*</span><span class="n">popt</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">resh_size</span><span class="p">),</span> <span class="n">contour_line</span> <span class="o">=</span> <span class="n">contour_line</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">GC</span></div>

<div class="viewcode-block" id="get_contour_line"><a class="viewcode-back" href="../Pulse_Processing_Utils.html#Pulse_Processing_utils.get_contour_line">[docs]</a><span class="k">def</span> <span class="nf">get_contour_line</span><span class="p">(</span><span class="n">cont_x</span><span class="p">,</span> <span class="n">cont_y</span><span class="p">,</span> <span class="n">contour_arr</span><span class="p">,</span> <span class="n">contour_line</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">contour_map</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">cont_x</span><span class="p">,</span> <span class="n">cont_y</span><span class="p">,</span> <span class="n">contour_arr</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">contour_map</span><span class="o">.</span><span class="n">collections</span><span class="p">[</span><span class="n">contour_line</span><span class="p">]</span><span class="o">.</span><span class="n">get_paths</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">vertices</span>
    <span class="n">plot_y</span><span class="p">,</span> <span class="n">plot_x</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">plot_x</span><span class="p">,</span> <span class="n">plot_y</span></div>

<div class="viewcode-block" id="extract_2pulse_histogram_from_filepath"><a class="viewcode-back" href="../Pulse_Processing_Utils.html#Pulse_Processing_utils.extract_2pulse_histogram_from_filepath">[docs]</a><span class="k">def</span> <span class="nf">extract_2pulse_histogram_from_filepath</span><span class="p">(</span><span class="n">datapath</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">bin_start</span> <span class="o">=</span> <span class="mi">55</span><span class="p">,</span> <span class="n">bin_stop</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span> <span class="n">hist_scale</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">even_only</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">odd_only</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">numRecords</span> <span class="o">=</span> <span class="mi">3840</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">IQ_offset</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)):</span> 
    <span class="n">I_offset</span><span class="p">,</span> <span class="n">Q_offset</span> <span class="o">=</span> <span class="n">IQ_offset</span>
    <span class="n">dd</span> <span class="o">=</span> <span class="n">all_datadicts_from_hdf5</span><span class="p">(</span><span class="n">datapath</span><span class="p">)[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
    
    <span class="n">time_unit</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span>
    
    <span class="c1"># print(np.size(np.unique(dd[&#39;time&#39;][&#39;values&#39;])))</span>
    <span class="n">time_vals</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">2</span><span class="p">)))</span>
    
    
    
    <span class="n">rec_unit</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;record_num&#39;</span><span class="p">][</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span>
    <span class="n">rec_num</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;record_num&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">2</span><span class="p">)))</span>
    
    <span class="n">I_plus</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;I_plus&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">2</span><span class="p">)))</span><span class="o">-</span><span class="n">I_offset</span>
    <span class="n">I_minus</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;I_minus&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">2</span><span class="p">)))</span><span class="o">-</span><span class="n">I_offset</span>
    
    <span class="n">Q_plus</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;Q_plus&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">2</span><span class="p">)))</span><span class="o">-</span><span class="n">Q_offset</span>
    <span class="n">Q_minus</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;Q_minus&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">2</span><span class="p">)))</span><span class="o">-</span><span class="n">Q_offset</span>
    
    <span class="c1"># print(np.size(I_minus))</span>
    
    <span class="c1">#averages</span>
    <span class="n">I_plus_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">I_plus</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">I_minus_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">I_minus</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">Q_plus_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">Q_plus</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">Q_minus_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">Q_minus</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">hist_scale</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span> 
        <span class="n">hist_scale</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">I_plus_avg</span><span class="p">,</span> <span class="n">I_minus_avg</span><span class="p">,</span> <span class="n">Q_plus_avg</span><span class="p">,</span> <span class="n">Q_minus_avg</span><span class="p">]))</span>
    
    <span class="c1">#re-weave the data back into it&#39;s original pre-saved form</span>
    
    <span class="n">bins_even</span><span class="p">,</span> <span class="n">bins_odd</span><span class="p">,</span> <span class="n">h_even</span><span class="p">,</span> <span class="n">h_odd</span> <span class="o">=</span> <span class="n">Process_One_Acquisition</span><span class="p">(</span><span class="n">datapath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">I_plus</span><span class="p">,</span> <span class="n">I_minus</span><span class="p">,</span> <span class="n">Q_plus</span><span class="p">,</span> <span class="n">Q_minus</span><span class="p">,</span> <span class="n">bin_start</span><span class="p">,</span> <span class="n">bin_stop</span><span class="p">,</span> <span class="n">hist_scale</span> <span class="o">=</span> <span class="n">hist_scale</span><span class="p">,</span> <span class="n">even_only</span> <span class="o">=</span> <span class="n">even_only</span><span class="p">,</span> <span class="n">odd_only</span> <span class="o">=</span> <span class="n">odd_only</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span><span class="p">)</span>
    
    <span class="n">Plus_x0Guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">I_plus_avg</span><span class="p">[</span><span class="n">bin_start</span><span class="p">:</span><span class="n">bin_stop</span><span class="p">]))</span>
    <span class="n">Plus_y0Guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">Q_plus_avg</span><span class="p">[</span><span class="n">bin_start</span><span class="p">:</span><span class="n">bin_stop</span><span class="p">]))</span>
    <span class="n">Plus_ampGuess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">h_even</span><span class="p">)</span>
    <span class="n">Plus_sxGuess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bins_even</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span>
    <span class="n">Plus_syGuess</span> <span class="o">=</span> <span class="n">Plus_sxGuess</span>
    <span class="n">Plus_thetaGuess</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">Plus_offsetGuess</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">Minus_x0Guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">I_minus_avg</span><span class="p">[</span><span class="n">bin_start</span><span class="p">:</span><span class="n">bin_stop</span><span class="p">]))</span>
    <span class="n">Minus_y0Guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">Q_minus_avg</span><span class="p">[</span><span class="n">bin_start</span><span class="p">:</span><span class="n">bin_stop</span><span class="p">]))</span>
    <span class="n">Minus_ampGuess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">h_even</span><span class="p">)</span>
    <span class="n">Minus_sxGuess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bins_even</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span>
    <span class="n">Minus_syGuess</span> <span class="o">=</span> <span class="n">Minus_sxGuess</span>
    <span class="n">Minus_thetaGuess</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">Minus_offsetGuess</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">guessParams</span> <span class="o">=</span> <span class="p">[[</span><span class="n">Plus_ampGuess</span><span class="p">,</span> <span class="n">Plus_x0Guess</span><span class="p">,</span> <span class="n">Plus_y0Guess</span><span class="p">,</span> <span class="n">Plus_sxGuess</span><span class="p">,</span> <span class="n">Plus_syGuess</span><span class="p">,</span> <span class="n">Plus_thetaGuess</span><span class="p">],</span>
                   <span class="p">[</span><span class="n">Minus_ampGuess</span><span class="p">,</span> <span class="n">Minus_x0Guess</span><span class="p">,</span> <span class="n">Minus_y0Guess</span><span class="p">,</span> <span class="n">Minus_sxGuess</span><span class="p">,</span> <span class="n">Minus_syGuess</span><span class="p">,</span> <span class="n">Minus_thetaGuess</span><span class="p">]]</span>
    
    <span class="k">return</span> <span class="n">bins_even</span><span class="p">,</span> <span class="n">bins_odd</span><span class="p">,</span> <span class="n">h_even</span><span class="p">,</span> <span class="n">h_odd</span><span class="p">,</span> <span class="n">guessParams</span></div>

<div class="viewcode-block" id="extract_3pulse_histogram_from_filepath"><a class="viewcode-back" href="../Pulse_Processing_Utils.html#Pulse_Processing_utils.extract_3pulse_histogram_from_filepath">[docs]</a><span class="k">def</span> <span class="nf">extract_3pulse_histogram_from_filepath</span><span class="p">(</span><span class="n">datapath</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">bin_start</span> <span class="o">=</span> <span class="mi">55</span><span class="p">,</span> <span class="n">bin_stop</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span> <span class="n">hist_scale</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">even_only</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">odd_only</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">numRecords</span> <span class="o">=</span> <span class="mi">3840</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">IQ_offset</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">state_relabel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
    <span class="n">I_offset</span><span class="p">,</span> <span class="n">Q_offset</span> <span class="o">=</span> <span class="n">IQ_offset</span>
    <span class="n">dd</span> <span class="o">=</span> <span class="n">all_datadicts_from_hdf5</span><span class="p">(</span><span class="n">datapath</span><span class="p">)[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
    
    <span class="n">time_unit</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span>
    
    <span class="c1"># print(np.size(np.unique(dd[&#39;time&#39;][&#39;values&#39;])))</span>
    <span class="n">time_vals</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">)))</span>
    
    
    
    <span class="n">rec_unit</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;record_num&#39;</span><span class="p">][</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span>
    <span class="n">rec_num</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;record_num&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cycling labels by &#39;</span><span class="p">,</span> <span class="n">state_relabel</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">state_relabel</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
        
        <span class="n">I_G</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;I_G&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">)))</span><span class="o">-</span><span class="n">I_offset</span>
        <span class="n">I_E</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;I_E&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">)))</span><span class="o">-</span><span class="n">I_offset</span>
        <span class="n">I_F</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;I_F&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">)))</span><span class="o">-</span><span class="n">I_offset</span>
        
        <span class="n">Q_G</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;Q_G&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">)))</span><span class="o">-</span><span class="n">Q_offset</span>
        <span class="n">Q_E</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;Q_E&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">)))</span><span class="o">-</span><span class="n">Q_offset</span>
        <span class="n">Q_F</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;Q_F&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">)))</span><span class="o">-</span><span class="n">Q_offset</span>
    <span class="k">elif</span> <span class="n">state_relabel</span> <span class="o">==</span><span class="mi">1</span><span class="p">:</span> 
        <span class="n">I_G</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;I_E&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">)))</span><span class="o">-</span><span class="n">I_offset</span>
        <span class="n">I_E</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;I_F&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">)))</span><span class="o">-</span><span class="n">I_offset</span>
        <span class="n">I_F</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;I_G&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">)))</span><span class="o">-</span><span class="n">I_offset</span>
        
        <span class="n">Q_G</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;Q_E&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">)))</span><span class="o">-</span><span class="n">Q_offset</span>
        <span class="n">Q_E</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;Q_F&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">)))</span><span class="o">-</span><span class="n">Q_offset</span>
        <span class="n">Q_F</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;Q_G&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">)))</span><span class="o">-</span><span class="n">Q_offset</span>
    <span class="k">elif</span> <span class="n">state_relabel</span> <span class="o">==</span><span class="mi">2</span><span class="p">:</span> 
        <span class="n">I_G</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;I_F&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">)))</span><span class="o">-</span><span class="n">I_offset</span>
        <span class="n">I_E</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;I_G&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">)))</span><span class="o">-</span><span class="n">I_offset</span>
        <span class="n">I_F</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;I_E&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">)))</span><span class="o">-</span><span class="n">I_offset</span>
        
        <span class="n">Q_G</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;Q_F&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">)))</span><span class="o">-</span><span class="n">Q_offset</span>
        <span class="n">Q_E</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;Q_G&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">)))</span><span class="o">-</span><span class="n">Q_offset</span>
        <span class="n">Q_F</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;Q_E&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">3</span><span class="p">)))</span><span class="o">-</span><span class="n">Q_offset</span>
    <span class="c1"># print(np.size(I_minus))</span>
    
    <span class="c1">#averages</span>
    <span class="n">I_G_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">I_G</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">I_E_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">I_E</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">I_F_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">I_F</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="n">Q_G_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">Q_G</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">Q_E_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">Q_E</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">Q_F_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">Q_F</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">hist_scale</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span> 
        <span class="n">hist_scale</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">I_G_avg</span><span class="p">,</span> <span class="n">I_E_avg</span><span class="p">,</span> <span class="n">Q_G_avg</span><span class="p">,</span> <span class="n">Q_E_avg</span><span class="p">]))</span>
    
    <span class="c1">#re-weave the data back into it&#39;s original pre-saved form</span>
    
    <span class="n">bins_G</span><span class="p">,</span> <span class="n">bins_E</span><span class="p">,</span> <span class="n">bins_F</span><span class="p">,</span> <span class="n">h_G</span><span class="p">,</span> <span class="n">h_E</span><span class="p">,</span> <span class="n">h_F</span> <span class="o">=</span> <span class="n">Process_One_Acquisition_3_state</span><span class="p">(</span><span class="n">datapath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">I_G</span><span class="p">,</span> <span class="n">I_E</span><span class="p">,</span> <span class="n">I_F</span><span class="p">,</span> <span class="n">Q_G</span><span class="p">,</span> <span class="n">Q_E</span><span class="p">,</span> <span class="n">Q_F</span><span class="p">,</span><span class="n">bin_start</span><span class="p">,</span> <span class="n">bin_stop</span><span class="p">,</span> <span class="n">hist_scale</span> <span class="o">=</span> <span class="n">hist_scale</span><span class="p">,</span> <span class="n">even_only</span> <span class="o">=</span> <span class="n">even_only</span><span class="p">,</span> <span class="n">odd_only</span> <span class="o">=</span> <span class="n">odd_only</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span><span class="p">)</span>
    
    <span class="n">G_x0Guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">I_G_avg</span><span class="p">[</span><span class="n">bin_start</span><span class="p">:</span><span class="n">bin_stop</span><span class="p">]))</span>
    <span class="n">G_y0Guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">Q_G_avg</span><span class="p">[</span><span class="n">bin_start</span><span class="p">:</span><span class="n">bin_stop</span><span class="p">]))</span>
    <span class="n">G_ampGuess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">h_G</span><span class="p">)</span>
    <span class="n">G_sxGuess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bins_G</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span>
    <span class="n">G_syGuess</span> <span class="o">=</span> <span class="n">G_sxGuess</span>
    <span class="n">G_thetaGuess</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">G_offsetGuess</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">E_x0Guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">I_E_avg</span><span class="p">[</span><span class="n">bin_start</span><span class="p">:</span><span class="n">bin_stop</span><span class="p">]))</span>
    <span class="n">E_y0Guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">Q_E_avg</span><span class="p">[</span><span class="n">bin_start</span><span class="p">:</span><span class="n">bin_stop</span><span class="p">]))</span>
    <span class="n">E_ampGuess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">h_E</span><span class="p">)</span>
    <span class="n">E_sxGuess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bins_E</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span>
    <span class="n">E_syGuess</span> <span class="o">=</span> <span class="n">E_sxGuess</span>
    <span class="n">E_thetaGuess</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">E_offsetGuess</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">F_x0Guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">I_F_avg</span><span class="p">[</span><span class="n">bin_start</span><span class="p">:</span><span class="n">bin_stop</span><span class="p">]))</span>
    <span class="n">F_y0Guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">Q_F_avg</span><span class="p">[</span><span class="n">bin_start</span><span class="p">:</span><span class="n">bin_stop</span><span class="p">]))</span>
    <span class="n">F_ampGuess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">h_F</span><span class="p">)</span>
    <span class="n">F_sxGuess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bins_F</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span>
    <span class="n">F_syGuess</span> <span class="o">=</span> <span class="n">F_sxGuess</span>
    <span class="n">F_thetaGuess</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">F_offsetGuess</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">guessParams</span> <span class="o">=</span> <span class="p">[[</span><span class="n">G_ampGuess</span><span class="p">,</span> <span class="n">G_x0Guess</span><span class="p">,</span> <span class="n">G_y0Guess</span><span class="p">,</span> <span class="n">G_sxGuess</span><span class="p">,</span> <span class="n">G_syGuess</span><span class="p">,</span> <span class="n">G_thetaGuess</span><span class="p">],</span>
                   <span class="p">[</span><span class="n">E_ampGuess</span><span class="p">,</span> <span class="n">E_x0Guess</span><span class="p">,</span> <span class="n">E_y0Guess</span><span class="p">,</span> <span class="n">E_sxGuess</span><span class="p">,</span> <span class="n">E_syGuess</span><span class="p">,</span> <span class="n">E_thetaGuess</span><span class="p">],</span> 
                   <span class="p">[</span><span class="n">F_ampGuess</span><span class="p">,</span> <span class="n">F_x0Guess</span><span class="p">,</span> <span class="n">F_y0Guess</span><span class="p">,</span> <span class="n">F_sxGuess</span><span class="p">,</span> <span class="n">F_syGuess</span><span class="p">,</span> <span class="n">F_thetaGuess</span><span class="p">]]</span>
    
    <span class="k">return</span> <span class="n">bins_G</span><span class="p">,</span> <span class="n">bins_E</span><span class="p">,</span> <span class="n">bins_F</span><span class="p">,</span> <span class="n">h_G</span><span class="p">,</span> <span class="n">h_E</span><span class="p">,</span> <span class="n">h_F</span><span class="p">,</span> <span class="n">guessParams</span></div>
        
<div class="viewcode-block" id="get_normalizing_voltage_from_filepath"><a class="viewcode-back" href="../Pulse_Processing_Utils.html#Pulse_Processing_utils.get_normalizing_voltage_from_filepath">[docs]</a><span class="k">def</span> <span class="nf">get_normalizing_voltage_from_filepath</span><span class="p">(</span><span class="n">amp_off_filepath</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">hist_scale</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">records_per_pulsetype</span> <span class="o">=</span> <span class="mi">3870</span><span class="o">*</span><span class="mi">2</span><span class="p">):</span> 
    
    <span class="n">bins_even</span><span class="p">,</span> <span class="n">bins_odd</span><span class="p">,</span> <span class="n">h_even</span><span class="p">,</span> <span class="n">h_odd</span><span class="p">,</span> <span class="n">guessParam</span> <span class="o">=</span> <span class="n">extract_2pulse_histogram_from_filepath</span><span class="p">(</span><span class="n">amp_off_filepath</span><span class="p">,</span> 
                                                                                               <span class="n">odd_only</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> 
                                                                                               <span class="n">numRecords</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">3840</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span> 
                                                                                               <span class="n">IQ_offset</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> 
                                                                                               <span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span><span class="p">,</span> 
                                                                                               <span class="n">hist_scale</span> <span class="o">=</span> <span class="n">hist_scale</span><span class="p">)</span>
    
    <span class="n">amp_off_even_fit</span> <span class="o">=</span> <span class="n">fit_2D_Gaussian</span><span class="p">(</span><span class="s1">&#39;amp_off_even&#39;</span><span class="p">,</span> <span class="n">bins_even</span><span class="p">,</span> <span class="n">h_even</span><span class="p">,</span> 
                                            <span class="n">guessParam</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                            <span class="n">max_fev</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
                                            <span class="n">contour_line</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">amp_off_odd_fit</span> <span class="o">=</span> <span class="n">fit_2D_Gaussian</span><span class="p">(</span><span class="s1">&#39;amp_off_odd&#39;</span><span class="p">,</span> <span class="n">bins_odd</span><span class="p">,</span> <span class="n">h_odd</span><span class="p">,</span>
                                            <span class="n">guessParam</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                            <span class="n">max_fev</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
                                            <span class="n">contour_line</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">even_fit</span> <span class="o">=</span> <span class="n">amp_off_even_fit</span>
    <span class="n">odd_fit</span> <span class="o">=</span> <span class="n">amp_off_odd_fit</span>
    
    <span class="n">histogram_data_fidelity</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">h_odd</span><span class="o">/</span><span class="n">records_per_pulsetype</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">h_even</span><span class="o">/</span><span class="n">records_per_pulsetype</span><span class="p">)))</span>
            
    <span class="n">bins_fine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">bins_even</span><span class="p">,</span> <span class="n">bins_odd</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">bins_even</span><span class="p">,</span> <span class="n">bins_odd</span><span class="p">]),</span> <span class="mi">1000</span><span class="p">)</span>
    
    <span class="n">even_fit_h</span> <span class="o">=</span> <span class="n">Gaussian_2D</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">bins_fine</span><span class="p">,</span> <span class="n">bins_fine</span><span class="p">),</span> <span class="o">*</span><span class="n">even_fit</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;popt&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">even_fit</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;amplitude&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">even_fit</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;sigma_x&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">even_fit</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;sigma_y&#39;</span><span class="p">])</span>
    
    <span class="n">odd_fit_h</span> <span class="o">=</span> <span class="n">Gaussian_2D</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">bins_fine</span><span class="p">,</span> <span class="n">bins_fine</span><span class="p">),</span> <span class="o">*</span><span class="n">odd_fit</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;popt&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">odd_fit</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;amplitude&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">odd_fit</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;sigma_x&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">odd_fit</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;sigma_y&#39;</span><span class="p">])</span>
    
    <span class="n">fit_fidelity</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">even_fit_h</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">even_fit_h</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">odd_fit_h</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">odd_fit_h</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Histogram data fidelity: </span><span class="si">{</span><span class="n">histogram_data_fidelity</span><span class="si">}</span><span class="se">\n</span><span class="s2">Fit fidelity: </span><span class="si">{</span><span class="n">fit_fidelity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span> 
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">bins_even</span><span class="p">,</span> <span class="n">bins_even</span><span class="p">,</span> <span class="n">h_even</span><span class="p">)</span>
        <span class="n">amp_off_even_fit</span><span class="o">.</span><span class="n">plot_on_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">amp_off_even_fit</span><span class="o">.</span><span class="n">sigma_contour</span><span class="p">())</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">bins_odd</span><span class="p">,</span> <span class="n">bins_odd</span><span class="p">,</span> <span class="n">h_odd</span><span class="p">)</span>
        <span class="n">amp_off_odd_fit</span><span class="o">.</span><span class="n">plot_on_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">amp_off_odd_fit</span><span class="o">.</span><span class="n">sigma_contour</span><span class="p">())</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>
    
    <span class="n">amp_off_voltage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">amp_off_odd_fit</span><span class="o">.</span><span class="n">center_vec</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">amp_off_even_fit</span><span class="o">.</span><span class="n">center_vec</span><span class="p">())])</span><span class="o">*</span><span class="mi">1000</span>
    
    <span class="k">return</span> <span class="n">amp_off_voltage</span></div>

<div class="viewcode-block" id="get_IQ_offset_from_filepath"><a class="viewcode-back" href="../Pulse_Processing_Utils.html#Pulse_Processing_utils.get_IQ_offset_from_filepath">[docs]</a><span class="k">def</span> <span class="nf">get_IQ_offset_from_filepath</span><span class="p">(</span><span class="n">amp_off_filepath</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">hist_scale</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">records_per_pulsetype</span> <span class="o">=</span> <span class="mi">3840</span><span class="o">*</span><span class="mi">2</span><span class="p">):</span> 
    
    <span class="n">bins_even</span><span class="p">,</span> <span class="n">bins_odd</span><span class="p">,</span> <span class="n">h_even</span><span class="p">,</span> <span class="n">h_odd</span><span class="p">,</span> <span class="n">guessParam</span> <span class="o">=</span> <span class="n">extract_2pulse_histogram_from_filepath</span><span class="p">(</span><span class="n">amp_off_filepath</span><span class="p">,</span> 
                                                                                               <span class="n">odd_only</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> 
                                                                                               <span class="n">numRecords</span> <span class="o">=</span> <span class="n">records_per_pulsetype</span><span class="p">,</span> 
                                                                                               <span class="n">IQ_offset</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> 
                                                                                               <span class="n">plot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                                                                                               <span class="n">hist_scale</span> <span class="o">=</span> <span class="n">hist_scale</span><span class="p">)</span>
    
    <span class="n">amp_off_even_fit</span> <span class="o">=</span> <span class="n">fit_2D_Gaussian</span><span class="p">(</span><span class="s1">&#39;amp_off_even&#39;</span><span class="p">,</span> <span class="n">bins_even</span><span class="p">,</span> <span class="n">h_even</span><span class="p">,</span> 
                                            <span class="n">guessParam</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                            <span class="n">max_fev</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
                                            <span class="n">contour_line</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">amp_off_odd_fit</span> <span class="o">=</span> <span class="n">fit_2D_Gaussian</span><span class="p">(</span><span class="s1">&#39;amp_off_odd&#39;</span><span class="p">,</span> <span class="n">bins_odd</span><span class="p">,</span> <span class="n">h_odd</span><span class="p">,</span>
                                            <span class="n">guessParam</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                            <span class="n">max_fev</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
                                            <span class="n">contour_line</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">even_fit</span> <span class="o">=</span> <span class="n">amp_off_even_fit</span>
    <span class="n">odd_fit</span> <span class="o">=</span> <span class="n">amp_off_odd_fit</span>
    
    <span class="n">histogram_data_fidelity</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">h_odd</span><span class="o">/</span><span class="n">records_per_pulsetype</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">h_even</span><span class="o">/</span><span class="n">records_per_pulsetype</span><span class="p">)))</span>
            
    <span class="n">bins_fine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">bins_even</span><span class="p">,</span> <span class="n">bins_odd</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">bins_even</span><span class="p">,</span> <span class="n">bins_odd</span><span class="p">]),</span> <span class="mi">1000</span><span class="p">)</span>
    
    <span class="n">even_fit_h</span> <span class="o">=</span> <span class="n">Gaussian_2D</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">bins_fine</span><span class="p">,</span> <span class="n">bins_fine</span><span class="p">),</span> <span class="o">*</span><span class="n">even_fit</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;popt&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">even_fit</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;amplitude&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">even_fit</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;sigma_x&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">even_fit</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;sigma_y&#39;</span><span class="p">])</span>
    
    <span class="n">odd_fit_h</span> <span class="o">=</span> <span class="n">Gaussian_2D</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">bins_fine</span><span class="p">,</span> <span class="n">bins_fine</span><span class="p">),</span> <span class="o">*</span><span class="n">odd_fit</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;popt&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">odd_fit</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;amplitude&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">odd_fit</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;sigma_x&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">odd_fit</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;sigma_y&#39;</span><span class="p">])</span>
    
    <span class="n">fit_fidelity</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">even_fit_h</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">even_fit_h</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">odd_fit_h</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">odd_fit_h</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Histogram data fidelity: </span><span class="si">{</span><span class="n">histogram_data_fidelity</span><span class="si">}</span><span class="se">\n</span><span class="s2">Fit fidelity: </span><span class="si">{</span><span class="n">fit_fidelity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span> 
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">bins_even</span><span class="p">,</span> <span class="n">bins_even</span><span class="p">,</span> <span class="n">h_even</span><span class="p">)</span>
        <span class="n">amp_off_even_fit</span><span class="o">.</span><span class="n">plot_on_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">amp_off_even_fit</span><span class="o">.</span><span class="n">sigma_contour</span><span class="p">())</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">bins_odd</span><span class="p">,</span> <span class="n">bins_odd</span><span class="p">,</span> <span class="n">h_odd</span><span class="p">)</span>
        <span class="n">amp_off_odd_fit</span><span class="o">.</span><span class="n">plot_on_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">amp_off_odd_fit</span><span class="o">.</span><span class="n">sigma_contour</span><span class="p">())</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>
    
    <span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">amp_off_odd_fit</span><span class="o">.</span><span class="n">center_vec</span><span class="p">(),</span> <span class="n">amp_off_even_fit</span><span class="o">.</span><span class="n">center_vec</span><span class="p">()]),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">offset</span></div>

<div class="viewcode-block" id="hist_discriminant"><a class="viewcode-back" href="../Pulse_Processing_Utils.html#Pulse_Processing_utils.hist_discriminant">[docs]</a><span class="k">def</span> <span class="nf">hist_discriminant</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">):</span>
    <span class="c1">#1 if in h1, 0 if in h2</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">h1</span><span class="o">-</span><span class="n">h2</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="get_fidelity_from_filepath"><a class="viewcode-back" href="../Pulse_Processing_Utils.html#Pulse_Processing_utils.get_fidelity_from_filepath">[docs]</a><span class="k">def</span> <span class="nf">get_fidelity_from_filepath</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">hist_scale</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">records_per_pulsetype</span> <span class="o">=</span> <span class="mi">3870</span><span class="o">*</span><span class="mi">2</span><span class="p">):</span> 
    
    <span class="n">bins_even</span><span class="p">,</span> <span class="n">bins_odd</span><span class="p">,</span> <span class="n">h_even</span><span class="p">,</span> <span class="n">h_odd</span><span class="p">,</span> <span class="n">guessParam</span> <span class="o">=</span> <span class="n">extract_2pulse_histogram_from_filepath</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> 
                                                                                               <span class="n">odd_only</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> 
                                                                                               <span class="n">numRecords</span> <span class="o">=</span> <span class="n">records_per_pulsetype</span><span class="p">,</span> 
                                                                                               <span class="n">IQ_offset</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> 
                                                                                               <span class="n">plot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                                                                                               <span class="n">hist_scale</span> <span class="o">=</span> <span class="n">hist_scale</span><span class="p">)</span>
    <span class="n">h_odd_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">h_odd</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h_odd</span><span class="p">))</span>
    <span class="n">h_even_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">h_even</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h_even</span><span class="p">))</span>
    
    <span class="n">amp_off_even_fit</span> <span class="o">=</span> <span class="n">fit_2D_Gaussian</span><span class="p">(</span><span class="s1">&#39;amp_off_even&#39;</span><span class="p">,</span> <span class="n">bins_even</span><span class="p">,</span> <span class="n">h_even</span><span class="p">,</span> 
                                            <span class="n">guessParam</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                            <span class="n">max_fev</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
                                            <span class="n">contour_line</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">amp_off_odd_fit</span> <span class="o">=</span> <span class="n">fit_2D_Gaussian</span><span class="p">(</span><span class="s1">&#39;amp_off_odd&#39;</span><span class="p">,</span> <span class="n">bins_odd</span><span class="p">,</span> <span class="n">h_odd</span><span class="p">,</span>
                                            <span class="n">guessParam</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                            <span class="n">max_fev</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
                                            <span class="n">contour_line</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">even_fit</span> <span class="o">=</span> <span class="n">amp_off_even_fit</span>
    <span class="n">odd_fit</span> <span class="o">=</span> <span class="n">amp_off_odd_fit</span>
    
    <span class="n">even_fit_h</span> <span class="o">=</span> <span class="n">Gaussian_2D</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">bins_even</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins_even</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="o">*</span><span class="n">even_fit</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;popt&#39;</span><span class="p">])</span>
    <span class="n">even_fit_h_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">even_fit_h</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">even_fit_h</span><span class="p">))</span>
    
    <span class="n">odd_fit_h</span> <span class="o">=</span> <span class="n">Gaussian_2D</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">bins_odd</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins_odd</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="o">*</span><span class="n">odd_fit</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;popt&#39;</span><span class="p">])</span>
    <span class="n">odd_fit_h_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">odd_fit_h</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">odd_fit_h</span><span class="p">))</span>
    
    <span class="n">is_even</span> <span class="o">=</span> <span class="n">hist_discriminant</span><span class="p">(</span><span class="n">even_fit_h</span><span class="p">,</span> <span class="n">odd_fit_h</span><span class="p">)</span>
    <span class="n">is_odd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">is_even</span><span class="p">)</span>
    
    <span class="c1">#debugging</span>
    <span class="c1"># print(np.sum(h_odd), np.sum(h_even))</span>
    <span class="c1"># print(np.sum(h_odd_norm), np.sum(h_even_norm))</span>
    <span class="c1"># print(&#39;fid sums&#39;, np.sum(h_odd_norm[is_even]), np.sum(h_even_norm[is_odd]))</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">bins_odd</span><span class="p">,</span> <span class="n">bins_odd</span><span class="p">,</span> <span class="n">h_odd_norm</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    
    <span class="n">data_fidelity</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h_odd_norm</span><span class="p">[</span><span class="n">is_even</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s2">&quot;float64&quot;</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h_even_norm</span><span class="p">[</span><span class="n">is_odd</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s2">&quot;float64&quot;</span><span class="p">)</span>
    <span class="n">fit_fidelity</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">odd_fit_h_norm</span><span class="p">[</span><span class="n">is_even</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s2">&quot;float64&quot;</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">even_fit_h_norm</span><span class="p">[</span><span class="n">is_odd</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s2">&quot;float64&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span> 
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">bins_even</span><span class="p">,</span> <span class="n">bins_even</span><span class="p">,</span> <span class="n">h_even</span><span class="p">)</span>
        <span class="n">amp_off_even_fit</span><span class="o">.</span><span class="n">plot_on_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">amp_off_even_fit</span><span class="o">.</span><span class="n">sigma_contour</span><span class="p">())</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">bins_odd</span><span class="p">,</span> <span class="n">bins_odd</span><span class="p">,</span> <span class="n">h_odd</span><span class="p">)</span>
        <span class="n">amp_off_odd_fit</span><span class="o">.</span><span class="n">plot_on_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">amp_off_odd_fit</span><span class="o">.</span><span class="n">sigma_contour</span><span class="p">())</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">bins_odd</span><span class="p">,</span> <span class="n">bins_odd</span><span class="p">,</span> <span class="n">is_even</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;seismic&#39;</span><span class="p">)</span>
        <span class="n">amp_off_odd_fit</span><span class="o">.</span><span class="n">plot_on_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">amp_off_even_fit</span><span class="o">.</span><span class="n">plot_on_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">amp_off_odd_fit</span><span class="o">.</span><span class="n">sigma_contour</span><span class="p">())</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">amp_off_even_fit</span><span class="o">.</span><span class="n">sigma_contour</span><span class="p">())</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>
    
    
    <span class="k">return</span> <span class="n">data_fidelity</span><span class="p">,</span> <span class="n">fit_fidelity</span><span class="p">,</span> <span class="n">even_fit</span><span class="p">,</span> <span class="n">odd_fit</span></div>

<div class="viewcode-block" id="get_fidelity_from_filepath_3_state"><a class="viewcode-back" href="../Pulse_Processing_Utils.html#Pulse_Processing_utils.get_fidelity_from_filepath_3_state">[docs]</a><span class="k">def</span> <span class="nf">get_fidelity_from_filepath_3_state</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">hist_scale</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">records_per_pulsetype</span> <span class="o">=</span> <span class="mi">2562</span><span class="p">,</span> <span class="n">state_relabel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bin_start</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">bin_stop</span> <span class="o">=</span> <span class="mi">150</span><span class="p">):</span> 
    
    <span class="n">bins_G</span><span class="p">,</span> <span class="n">bins_E</span><span class="p">,</span> <span class="n">bins_F</span><span class="p">,</span> <span class="n">h_G</span><span class="p">,</span> <span class="n">h_E</span><span class="p">,</span> <span class="n">h_F</span><span class="p">,</span> <span class="n">guessParam</span> <span class="o">=</span> <span class="n">extract_3pulse_histogram_from_filepath</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> 
                                                                                               <span class="n">odd_only</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> 
                                                                                               <span class="n">numRecords</span> <span class="o">=</span> <span class="n">records_per_pulsetype</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> 
                                                                                               <span class="n">IQ_offset</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> 
                                                                                               <span class="n">plot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                                                                                               <span class="n">hist_scale</span> <span class="o">=</span> <span class="n">hist_scale</span><span class="p">,</span> 
                                                                                               <span class="n">state_relabel</span> <span class="o">=</span> <span class="n">state_relabel</span><span class="p">,</span> 
                                                                                               <span class="n">bin_start</span> <span class="o">=</span> <span class="n">bin_start</span><span class="p">,</span> 
                                                                                               <span class="n">bin_stop</span> <span class="o">=</span> <span class="n">bin_stop</span><span class="p">)</span>
    <span class="n">h_odd_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">h_E</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h_E</span><span class="p">))</span>
    <span class="n">h_even_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">h_G</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h_G</span><span class="p">))</span>
    
    <span class="n">G_fit</span> <span class="o">=</span> <span class="n">fit_2D_Gaussian</span><span class="p">(</span><span class="s1">&#39;amp_off_even&#39;</span><span class="p">,</span> <span class="n">bins_G</span><span class="p">,</span> <span class="n">h_G</span><span class="p">,</span> 
                                            <span class="n">guessParam</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                            <span class="n">max_fev</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
                                            <span class="n">contour_line</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">E_fit</span> <span class="o">=</span> <span class="n">fit_2D_Gaussian</span><span class="p">(</span><span class="s1">&#39;amp_off_odd&#39;</span><span class="p">,</span> <span class="n">bins_E</span><span class="p">,</span> <span class="n">h_E</span><span class="p">,</span>
                                            <span class="n">guessParam</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                            <span class="n">max_fev</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
                                            <span class="n">contour_line</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">F_fit</span> <span class="o">=</span> <span class="n">fit_2D_Gaussian</span><span class="p">(</span><span class="s1">&#39;amp_off_odd&#39;</span><span class="p">,</span> <span class="n">bins_F</span><span class="p">,</span> <span class="n">h_F</span><span class="p">,</span>
                                            <span class="n">guessParam</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                            <span class="n">max_fev</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
                                            <span class="n">contour_line</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
    
    
    
    <span class="n">G_fit_h</span> <span class="o">=</span> <span class="n">Gaussian_2D</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">bins_G</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins_G</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="o">*</span><span class="n">G_fit</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;popt&#39;</span><span class="p">])</span>
    <span class="n">G_fit_h_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">G_fit_h</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">G_fit_h</span><span class="p">))</span>
    
    <span class="n">E_fit_h</span> <span class="o">=</span> <span class="n">Gaussian_2D</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">bins_E</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins_E</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="o">*</span><span class="n">E_fit</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;popt&#39;</span><span class="p">])</span>
    <span class="n">E_fit_h_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">E_fit_h</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">E_fit_h</span><span class="p">))</span>
    
    <span class="n">F_fit_h</span> <span class="o">=</span> <span class="n">Gaussian_2D</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">bins_F</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins_F</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="o">*</span><span class="n">F_fit</span><span class="o">.</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;popt&#39;</span><span class="p">])</span>
    <span class="n">F_fit_h_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">F_fit_h</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">F_fit_h</span><span class="p">))</span>
    
    <span class="c1"># is_even = hist_discriminant(even_fit_h, odd_fit_h)</span>
    <span class="c1"># is_odd = np.logical_not(is_even)</span>
    
    <span class="c1"># #debugging</span>
    <span class="c1"># # print(np.sum(h_odd), np.sum(h_even))</span>
    <span class="c1"># # print(np.sum(h_odd_norm), np.sum(h_even_norm))</span>
    <span class="c1"># # print(&#39;fid sums&#39;, np.sum(h_odd_norm[is_even]), np.sum(h_even_norm[is_odd]))</span>
    
    <span class="c1"># plt.pcolormesh(bins_odd, bins_odd, h_odd_norm)</span>
    <span class="c1"># plt.colorbar()</span>
    
    <span class="c1"># data_fidelity = 1-np.sum(h_odd_norm[is_even], dtype = &quot;float64&quot;)-np.sum(h_even_norm[is_odd], dtype = &quot;float64&quot;)</span>
    <span class="c1"># fit_fidelity = 1-np.sum(odd_fit_h_norm[is_even], dtype = &quot;float64&quot;)-np.sum(even_fit_h_norm[is_odd], dtype = &quot;float64&quot;)</span>
    
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span> 
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">bins_G</span><span class="p">,</span> <span class="n">bins_G</span><span class="p">,</span> <span class="n">h_G</span><span class="p">)</span>
        <span class="n">G_fit</span><span class="o">.</span><span class="n">plot_on_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">G_fit</span><span class="o">.</span><span class="n">sigma_contour</span><span class="p">())</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">bins_E</span><span class="p">,</span> <span class="n">bins_E</span><span class="p">,</span> <span class="n">h_E</span><span class="p">)</span>
        <span class="n">E_fit</span><span class="o">.</span><span class="n">plot_on_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">E_fit</span><span class="o">.</span><span class="n">sigma_contour</span><span class="p">())</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">bins_F</span><span class="p">,</span> <span class="n">bins_F</span><span class="p">,</span> <span class="n">h_F</span><span class="p">)</span>
        <span class="n">F_fit</span><span class="o">.</span><span class="n">plot_on_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">F_fit</span><span class="o">.</span><span class="n">sigma_contour</span><span class="p">())</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>
        
        <span class="c1"># fig, ax = plt.subplots()</span>
        <span class="c1"># # pc = ax.pcolormesh(bins_odd, bins_odd, is_even, cmap = &#39;seismic&#39;)</span>
        <span class="c1"># amp_off_odd_fit.plot_on_ax(ax)</span>
        <span class="c1"># amp_off_even_fit.plot_on_ax(ax)</span>
        <span class="c1"># ax.add_patch(amp_off_odd_fit.sigma_contour())</span>
        <span class="c1"># ax.add_patch(amp_off_even_fit.sigma_contour())</span>
        <span class="c1"># ax.set_aspect(1)</span>
        <span class="c1"># plt.colorbar(pc)</span>
    
    
    <span class="k">return</span> <span class="kc">None</span> <span class="c1">#data_fidelity, fit_fidelity, even_fit, odd_fit</span></div>
<div class="viewcode-block" id="get_fidelity_vs_records"><a class="viewcode-back" href="../Pulse_Processing_Utils.html#Pulse_Processing_utils.get_fidelity_vs_records">[docs]</a><span class="k">def</span> <span class="nf">get_fidelity_vs_records</span><span class="p">(</span><span class="n">datapath</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">hist_scale</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">records_per_pulsetype</span> <span class="o">=</span> <span class="mi">3870</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">bin_start</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">bin_stop</span> <span class="o">=</span> <span class="mi">150</span><span class="p">):</span> 
    <span class="n">odd_only</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">numRecords</span> <span class="o">=</span> <span class="n">records_per_pulsetype</span>
    <span class="n">IQ_offset</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 

    <span class="n">I_offset</span><span class="p">,</span> <span class="n">Q_offset</span> <span class="o">=</span> <span class="n">IQ_offset</span>
    <span class="n">dd</span> <span class="o">=</span> <span class="n">all_datadicts_from_hdf5</span><span class="p">(</span><span class="n">datapath</span><span class="p">)[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
    
    <span class="n">time_unit</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])))</span>
    <span class="n">time_vals</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">2</span><span class="p">)))</span>
    
    
    
    <span class="n">rec_unit</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;record_num&#39;</span><span class="p">][</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span>
    <span class="n">rec_num</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;record_num&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">2</span><span class="p">)))</span>
    
    <span class="n">I_plus</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;I_plus&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">2</span><span class="p">)))</span><span class="o">-</span><span class="n">I_offset</span>
    <span class="n">I_minus</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;I_minus&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">2</span><span class="p">)))</span><span class="o">-</span><span class="n">I_offset</span>
    
    <span class="n">Q_plus</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;Q_plus&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">2</span><span class="p">)))</span><span class="o">-</span><span class="n">Q_offset</span>
    <span class="n">Q_minus</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;Q_minus&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span><span class="o">//</span><span class="p">(</span><span class="n">numRecords</span><span class="o">//</span><span class="mi">2</span><span class="p">)))</span><span class="o">-</span><span class="n">Q_offset</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">I_minus</span><span class="p">))</span>
    
    <span class="c1">#averages</span>
    <span class="n">I_plus_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">I_plus</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">I_minus_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">I_minus</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">Q_plus_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">Q_plus</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">Q_minus_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">Q_minus</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">hist_scale</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span> 
        <span class="n">hist_scale</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">I_plus_avg</span><span class="p">,</span> <span class="n">I_minus_avg</span><span class="p">,</span> <span class="n">Q_plus_avg</span><span class="p">,</span> <span class="n">Q_minus_avg</span><span class="p">]))</span>
    
    <span class="c1">#re-weave the data back into it&#39;s original pre-saved form</span>
    
    <span class="n">bins_even</span><span class="p">,</span> <span class="n">bins_odd</span><span class="p">,</span> <span class="n">h_even</span><span class="p">,</span> <span class="n">h_odd</span> <span class="o">=</span> <span class="n">Process_One_Acquisition</span><span class="p">(</span><span class="n">datapath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">I_plus</span><span class="p">,</span> <span class="n">I_minus</span><span class="p">,</span> <span class="n">Q_plus</span><span class="p">,</span> <span class="n">Q_minus</span><span class="p">,</span> <span class="n">bin_start</span><span class="p">,</span> <span class="n">bin_stop</span><span class="p">,</span> <span class="n">hist_scale</span> <span class="o">=</span> <span class="n">hist_scale</span><span class="p">,</span> <span class="n">even_only</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">odd_only</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span><span class="p">)</span>
    
    <span class="n">Plus_x0Guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">I_plus_avg</span><span class="p">[</span><span class="n">bin_start</span><span class="p">:</span><span class="n">bin_stop</span><span class="p">]))</span>
    <span class="n">Plus_y0Guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">Q_plus_avg</span><span class="p">[</span><span class="n">bin_start</span><span class="p">:</span><span class="n">bin_stop</span><span class="p">]))</span>
    <span class="n">Plus_ampGuess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">h_even</span><span class="p">)</span>
    <span class="n">Plus_sxGuess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bins_even</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span>
    <span class="n">Plus_syGuess</span> <span class="o">=</span> <span class="n">Plus_sxGuess</span>
    <span class="n">Plus_thetaGuess</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">Plus_offsetGuess</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">Minus_x0Guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">I_minus_avg</span><span class="p">[</span><span class="n">bin_start</span><span class="p">:</span><span class="n">bin_stop</span><span class="p">]))</span>
    <span class="n">Minus_y0Guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">Q_minus_avg</span><span class="p">[</span><span class="n">bin_start</span><span class="p">:</span><span class="n">bin_stop</span><span class="p">]))</span>
    <span class="n">Minus_ampGuess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">h_even</span><span class="p">)</span>
    <span class="n">Minus_sxGuess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bins_even</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span>
    <span class="n">Minus_syGuess</span> <span class="o">=</span> <span class="n">Minus_sxGuess</span>
    <span class="n">Minus_thetaGuess</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">Minus_offsetGuess</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">guessParams</span> <span class="o">=</span> <span class="p">[[</span><span class="n">Plus_ampGuess</span><span class="p">,</span> <span class="n">Plus_x0Guess</span><span class="p">,</span> <span class="n">Plus_y0Guess</span><span class="p">,</span> <span class="n">Plus_sxGuess</span><span class="p">,</span> <span class="n">Plus_syGuess</span><span class="p">,</span> <span class="n">Plus_thetaGuess</span><span class="p">],</span>
                   <span class="p">[</span><span class="n">Minus_ampGuess</span><span class="p">,</span> <span class="n">Minus_x0Guess</span><span class="p">,</span> <span class="n">Minus_y0Guess</span><span class="p">,</span> <span class="n">Minus_sxGuess</span><span class="p">,</span> <span class="n">Minus_syGuess</span><span class="p">,</span> <span class="n">Minus_thetaGuess</span><span class="p">]]</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Hatlab Data Processing 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Pulse_Processing_utils</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, Boris Mesits.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.2.0.
    </div>
  </body>
</html>